import streamlit as st
import numpy as np
from PIL import Image
import io
import random
import time
import tensorflow as tf

# C·∫•u h√¨nh trang
st.set_page_config(
    page_title="MONFRESH - ƒê√°nh gi√° ƒë·ªô t∆∞∆°i th·ªãt b·∫±ng AI",
    page_icon="ü•©",
    layout="wide",
    initial_sidebar_state="collapsed"
)

# CSS t√πy ch·ªânh cho MONFRESH
st.markdown("""
<style>
    .main-header {
        background: linear-gradient(90deg, #007bff, #28a745);
        padding: 1rem;
        border-radius: 10px;
        color: white;
        text-align: center;
        margin-bottom: 2rem;
    }
    .hero-section {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 2rem;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 2rem;
    }
    .cta-button {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        border: none;
        font-weight: bold;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .cta-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,123,255,0.4);
    }
    .result-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin: 1rem 0;
    }
    .footer {
        background: #343a40;
        color: white;
        padding: 2rem;
        border-radius: 10px;
        margin-top: 3rem;
    }
</style>
""", unsafe_allow_html=True)

# Constants t·ª´ model training
INPUT_SHAPE = (224, 224, 3)
CLASS_NAMES = {0: 'FRESH', 1: 'HALF', 2: 'SPOILED'}
CLASS_NAMES_VI = {0: 'T∆∞∆°i', 1: 'S·∫Øp h∆∞', 2: 'H·ªèng'}
CLASS_NAMES_LA = {0: '‡∫™‡∫ª‡∫î', 1: '‡ªÉ‡∫Å‡ªâ‡ªÄ‡∫™‡∫ç', 2: '‡ªÄ‡∫™‡∫ç'}
CLASS_NAMES_KH = {0: '·ûü·üí·ûö·ûü·üã', 1: '·ûá·û∑·ûè·ûÅ·ûº·ûÖ', 2: '·ûÅ·ûº·ûÖ'}

@st.cache_resource
def load_model():
    """Load model ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán"""
    try:
        model = tf.keras.models.load_model('TinyYolo_model.keras')
        return model
    except:
        try:
            model = tf.keras.models.load_model('TinyYolo_model.h5')
            return model
        except Exception as e:
            st.error(f"Kh√¥ng th·ªÉ load model: {e}")
            return None

def preprocess_image(image):
    """Ti·ªÅn x·ª≠ l√Ω ·∫£nh theo c√πng c√°ch nh∆∞ khi training"""
    # Resize ·∫£nh v·ªÅ k√≠ch th∆∞·ªõc 224x224
    image = image.resize((224, 224))
    
    # Chuy·ªÉn th√†nh numpy array
    img_array = np.array(image)
    
    # ƒê·∫£m b·∫£o c√≥ 3 channels (RGB)
    if img_array.shape[-1] == 4:  # RGBA
        img_array = img_array[:, :, :3]
    elif len(img_array.shape) == 2:  # Grayscale
        img_array = np.stack([img_array] * 3, axis=-1)
    
    # Chu·∫©n h√≥a pixel values v·ªÅ [0, 1]
    img_array = img_array.astype(np.float32) / 255.0
    
    # Th√™m batch dimension
    img_array = np.expand_dims(img_array, axis=0)
    
    return img_array

def predict_image(model, image):
    """D·ª± ƒëo√°n ƒë·ªô t∆∞∆°i c·ªßa th·ªãt"""
    processed_image = preprocess_image(image)
    predictions = model.predict(processed_image)
    
    # L·∫•y class c√≥ x√°c su·∫•t cao nh·∫•t
    predicted_class = np.argmax(predictions[0])
    confidence = predictions[0][predicted_class]
    
    return predicted_class, confidence, predictions[0]

def analyze_image_monfresh(model, image, col, class_names, ui_text):
    """Ph√¢n t√≠ch ·∫£nh v√† hi·ªÉn th·ªã k·∫øt qu·∫£ v·ªõi style MONFRESH"""
    with st.spinner("ü§ñ AI ƒëang ph√¢n t√≠ch ·∫£nh..."):
        try:
            predicted_class, confidence, all_predictions = predict_image(model, image)
            
            # Hi·ªÉn th·ªã k·∫øt qu·∫£ trong c·ªôt ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh
            with col:
                st.markdown(f"### {ui_text['result_title']}")
                
                # K·∫øt qu·∫£ ch√≠nh v·ªõi style MONFRESH
                class_name = class_names[predicted_class]
                
                # Ch·ªçn m√†u v√† icon theo k·∫øt qu·∫£
                if predicted_class == 0:  # Fresh
                    color = "üü¢"
                    emoji = "üòä"
                    bg_color = "#d4edda"
                    text_color = "#155724"
                    recommendation = "‚úÖ Th·ªãt c√≤n t∆∞∆°i, c√≥ th·ªÉ s·ª≠ d·ª•ng an to√†n."
                elif predicted_class == 1:  # Half
                    color = "üü°" 
                    emoji = "üò∞"
                    bg_color = "#fff3cd"
                    text_color = "#856404"
                    recommendation = "‚ö†Ô∏è Th·ªãt s·∫Øp h∆∞, n√™n s·ª≠ d·ª•ng s·ªõm ho·∫∑c ki·ªÉm tra k·ªπ."
                else:  # Spoiled
                    color = "üî¥"
                    emoji = "ü§¢"
                    bg_color = "#f8d7da"
                    text_color = "#721c24"
                    recommendation = "‚ùå Th·ªãt ƒë√£ h·ªèng, kh√¥ng n√™n s·ª≠ d·ª•ng."
                
                # K·∫øt qu·∫£ ch√≠nh
                st.markdown(f"""
                <div style="padding: 20px; border-radius: 15px; background-color: {bg_color}; color: {text_color}; text-align: center; margin: 10px 0;">
                    <h2>{emoji} {class_name}</h2>
                    <h3>{ui_text['confidence']}: {confidence:.1%}</h3>
                </div>
                """, unsafe_allow_html=True)
                
                # Thanh m√†u theo c·∫•p ƒë·ªô
                st.markdown(f"### {ui_text['details_title']}")
                
                for i, (class_id, prob) in enumerate(zip(class_names.keys(), all_predictions)):
                    class_name = class_names[class_id]
                    
                    # Progress bar v·ªõi m√†u s·∫Øc
                    if i == 0:
                        st.success(f"üü¢ {class_name}")
                    elif i == 1:
                        st.warning(f"üü° {class_name}")
                    else:
                        st.error(f"üî¥ {class_name}")
                    
                    st.progress(float(prob))
                    st.write(f"**{prob:.1%}**")
                    st.write("")
                
                # Khuy·∫øn ngh·ªã
                st.markdown(f"### {ui_text['recommendation_title']}")
                st.info(recommendation)
                
                # QR Code v√† chia s·∫ª (placeholder)
                st.markdown(f"### {ui_text['share_title']}")
                col_qr1, col_qr2 = st.columns(2)
                with col_qr1:
                    st.button(ui_text['zalo_btn'], key="zalo_share")
                with col_qr2:
                    st.button(ui_text['email_btn'], key="email_share")
        
        except Exception as e:
            st.error(f"L·ªói khi d·ª± ƒëo√°n: {e}")

def analyze_image(model, image, col):
    """Ph√¢n t√≠ch ·∫£nh v√† hi·ªÉn th·ªã k·∫øt qu·∫£ (legacy)"""
    ui_text_vi = {
        "result_title": "üìä K·∫øt qu·∫£ ph√¢n lo·∫°i",
        "confidence": "ƒê·ªô tin c·∫≠y",
        "details_title": "üìà Chi ti·∫øt x√°c su·∫•t",
        "recommendation_title": "üí° Khuy·∫øn ngh·ªã",
        "share_title": "üîó Chia s·∫ª k·∫øt qu·∫£",
        "zalo_btn": "üì± G·ª≠i qua Zalo",
        "email_btn": "üìß G·ª≠i qua Email"
    }
    analyze_image_monfresh(model, image, col, CLASS_NAMES_VI, ui_text_vi)

def main():
    # Header v·ªõi logo MONFRESH th·∫≠t
    st.markdown("""
    <div class="main-header">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; align-items: center;">
                <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=" 
                     style="width: 60px; height: 60px; margin-right: 15px; border-radius: 10px;">
                <div>
                    <h1 style="margin: 0; color: white;">ü•© MONFRESH</h1>
                    <p style="margin: 0; color: white;"><strong>Chu·∫©n h√≥a ƒë·ªô t∆∞∆°i ‚Äì N√¢ng t·∫ßm th·ª±c ph·∫©m</strong></p>
                </div>
            </div>
            <div style="text-align: right; color: white;">
                <p style="margin: 0; font-size: 14px;">ƒê·ªëi t√°c c√¥ng ngh·ªá:</p>
                <p style="margin: 0; font-size: 12px;">IUH & Ecotech - TechFest Vietnam</p>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # Hero Section v·ªõi text ƒëa ng√¥n ng·ªØ
    st.markdown(f"""
    <div class="hero-section">
        <h2>üîç {ui_text['hero_title']}</h2>
        <p>{ui_text['hero_subtitle']}</p>
        <p><strong>Ch·ªâ c·∫ßn m·ªôt b·ª©c ·∫£nh ƒë·ªÉ bi·∫øt th·ªãt c√≤n t∆∞∆°i hay kh√¥ng!</strong></p>
    </div>
    """, unsafe_allow_html=True)
    
    # Load model
    model = load_model()
    if model is None:
        st.error("Kh√¥ng th·ªÉ load model. Vui l√≤ng ki·ªÉm tra file model.")
        return
    
    # Navigation menu
    st.markdown("""
    <div style="background: white; padding: 10px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 20px;">
                <a href="#" style="text-decoration: none; color: #007bff; font-weight: bold;">üè† Trang ch·ªß</a>
                <a href="#" style="text-decoration: none; color: #007bff;">üìñ H∆∞·ªõng d·∫´n</a>
                <a href="#" style="text-decoration: none; color: #007bff;">üìä L·ªãch s·ª≠</a>
                <a href="#" style="text-decoration: none; color: #007bff;">üë§ ƒêƒÉng nh·∫≠p</a>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="color: #666;">üåê</span>
                <select id="language-select" style="padding: 5px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="vi">üáªüá≥ Ti·∫øng Vi·ªát</option>
                    <option value="en">üá¨üáß English</option>
                    <option value="la">üá±üá¶ ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß</option>
                    <option value="kh">üá∞üá≠ ·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö</option>
                </select>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)
    
    # Language selector (Streamlit native)
    col1, col2, col3, col4, col5 = st.columns(5)
    with col1:
        language = st.selectbox("üåê Ng√¥n ng·ªØ", ["üáªüá≥ Ti·∫øng Vi·ªát", "üá¨üáß English", "üá±üá¶ ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß", "üá∞üá≠ ·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö"])
    
    # Map language to class names and UI text
    if "Ti·∫øng Vi·ªát" in language:
        class_names = CLASS_NAMES_VI
        ui_text = {
            "hero_title": "ƒê√°nh gi√° ƒë·ªô t∆∞∆°i c·ªßa th·ªãt trong v√†i gi√¢y b·∫±ng AI",
            "hero_subtitle": "C√¥ng ngh·ªá kh√¥ng ch·∫°m: an to√†n ‚Äì minh b·∫°ch ‚Äì ƒë∆°n gi·∫£n",
            "upload_title": "üì§ Upload ·∫£nh t·ª´ thi·∫øt b·ªã",
            "upload_desc": "K√©o & th·∫£ ho·∫∑c ch·ªçn ·∫£nh th·ªãt c·∫ßn ki·ªÉm tra",
            "camera_title": "üì∑ Ch·ª•p ·∫£nh t·ª´ camera",
            "analyze_btn": "üîç Ph√¢n t√≠ch ƒë·ªô t∆∞∆°i",
            "result_title": "üìä K·∫øt qu·∫£ ph√¢n lo·∫°i",
            "confidence": "ƒê·ªô tin c·∫≠y",
            "details_title": "üìà Chi ti·∫øt x√°c su·∫•t",
            "recommendation_title": "üí° Khuy·∫øn ngh·ªã",
            "share_title": "üîó Chia s·∫ª k·∫øt qu·∫£",
            "zalo_btn": "üì± G·ª≠i qua Zalo",
            "email_btn": "üìß G·ª≠i qua Email"
        }
    elif "English" in language:
        class_names = CLASS_NAMES
        ui_text = {
            "hero_title": "Assess meat freshness in seconds with AI",
            "hero_subtitle": "Touchless technology: safe ‚Äì transparent ‚Äì simple",
            "upload_title": "üì§ Upload image from device",
            "upload_desc": "Drag & drop or select meat image to check",
            "camera_title": "üì∑ Take photo with camera",
            "analyze_btn": "üîç Analyze freshness",
            "result_title": "üìä Classification result",
            "confidence": "Confidence",
            "details_title": "üìà Probability details",
            "recommendation_title": "üí° Recommendation",
            "share_title": "üîó Share result",
            "zalo_btn": "üì± Send via Zalo",
            "email_btn": "üìß Send via Email"
        }
    elif "‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß" in language:
        class_names = CLASS_NAMES_LA
        ui_text = {
            "hero_title": "‡∫õ‡∫∞‡ªÄ‡∫°‡∫µ‡∫ô‡∫Ñ‡∫ß‡∫≤‡∫°‡∫™‡∫ª‡∫î‡∫Ç‡∫≠‡∫á‡∫ä‡∫µ‡ªâ‡∫ô‡ªÉ‡∫ô‡∫ö‡∫±‡∫ô‡∫ó‡∫±‡∫î‡∫î‡ªâ‡∫ß‡∫ç AI",
            "hero_subtitle": "‡ªÄ‡∫ó‡∫±‡∫Å‡ªÇ‡∫ô‡ªÇ‡∫•‡∫ä‡∫µ‡∫ö‡ªç‡ªà‡∫™‡∫≥‡∫û‡∫±‡∫î: ‡∫õ‡∫≠‡∫î‡ªÑ‡∫û ‚Äì ‡ªÇ‡∫õ‡ªà‡∫á‡ªÉ‡∫™ ‚Äì ‡∫á‡ªà‡∫≤‡∫ç‡∫î‡∫≤‡∫ç",
            "upload_title": "üì§ ‡∫≠‡∫±‡∫ö‡ªÇ‡∫´‡∫•‡∫î‡∫Æ‡∫π‡∫ö‡∫à‡∫≤‡∫Å‡∫≠‡∫∏‡∫õ‡∫∞‡∫Å‡∫≠‡∫ô",
            "upload_desc": "‡∫•‡∫≤‡∫Å & ‡∫ß‡∫≤‡∫á ‡∫´‡∫º‡∫∑ ‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫Æ‡∫π‡∫ö‡∫ä‡∫µ‡ªâ‡∫ô‡ªÄ‡∫û‡∫∑‡ªà‡∫≠‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö",
            "camera_title": "üì∑ ‡∫ñ‡ªà‡∫≤‡∫ç‡∫Æ‡∫π‡∫ö‡∫î‡ªâ‡∫ß‡∫ç‡∫Å‡ªâ‡∫≠‡∫á",
            "analyze_btn": "üîç ‡∫ß‡∫¥‡ªÄ‡∫Ñ‡∫≤‡∫∞‡∫Ñ‡∫ß‡∫≤‡∫°‡∫™‡∫ª‡∫î",
            "result_title": "üìä ‡∫ú‡∫ª‡∫ô‡∫Å‡∫≤‡∫ô‡∫à‡∫±‡∫î‡∫õ‡∫∞‡ªÄ‡∫û‡∫î",
            "confidence": "‡∫Ñ‡∫ß‡∫≤‡∫°‡ªù‡∫±‡ªâ‡∫ô‡ªÉ‡∫à",
            "details_title": "üìà ‡∫•‡∫≤‡∫ç‡∫•‡∫∞‡∫≠‡∫Ω‡∫î‡∫Ñ‡∫ß‡∫≤‡∫°‡ªÄ‡∫õ‡∫±‡∫ô‡ªÑ‡∫õ‡ªÑ‡∫î‡ªâ",
            "recommendation_title": "üí° ‡∫Ñ‡∫≥‡ªÅ‡∫ô‡∫∞‡∫ô‡∫≥",
            "share_title": "üîó ‡ªÅ‡∫ö‡ªà‡∫á‡∫õ‡∫±‡∫ô‡∫ú‡∫ª‡∫ô",
            "zalo_btn": "üì± ‡∫™‡∫ª‡ªà‡∫á‡∫ú‡ªà‡∫≤‡∫ô Zalo",
            "email_btn": "üìß ‡∫™‡∫ª‡ªà‡∫á‡∫ú‡ªà‡∫≤‡∫ô Email"
        }
    else:  # Khmer
        class_names = CLASS_NAMES_KH
        ui_text = {
            "hero_title": "·ûú·û∂·ûô·ûè·ûò·üí·ûõ·üÉ·ûó·û∂·ûñ·ûü·üí·ûö·ûü·üã·ûö·ûî·ûü·üã·ûü·û∂·ûÖ·üã·ûÄ·üí·ûì·ûª·ûÑ·ûú·û∑·ûì·û∂·ûë·û∏·ûá·û∂·ûò·ûΩ·ûô AI",
            "hero_subtitle": "·ûî·ûÖ·üí·ûÖ·üÅ·ûÄ·ûú·û∑·ûë·üí·ûô·û∂·ûò·û∑·ûì·ûî·üâ·üá: ·ûü·ûª·ûú·ûè·üí·ûê·û∑·ûó·û∂·ûñ ‚Äì ·ûó·û∂·ûñ·ûÖ·üí·ûî·û∂·ûü·üã·ûõ·û∂·ûü·üã ‚Äì ·ûó·û∂·ûñ·ûÑ·û∂·ûô·ûü·üí·ûö·ûΩ·ûõ",
            "upload_title": "üì§ ·ûï·üí·ûë·ûª·ûÄ·ûö·ûº·ûî·ûó·û∂·ûñ·û°·ûæ·ûÑ·ûñ·û∏·ûß·ûî·ûÄ·ûö·ûé·üç",
            "upload_desc": "·ûë·û∂·ûâ & ·ûä·û∂·ûÄ·üã ·û¨·ûá·üí·ûö·ûæ·ûü·ûö·ûº·ûî·ûó·û∂·ûñ·ûü·û∂·ûÖ·üã·ûä·ûæ·ûò·üí·ûî·û∏·ûñ·û∑·ûì·û∑·ûè·üí·ûô",
            "camera_title": "üì∑ ·ûê·ûè·ûö·ûº·ûî·ûá·û∂·ûò·ûΩ·ûô·ûÄ·û∂·ûò·üÅ·ûö·üâ·û∂",
            "analyze_btn": "üîç ·ûú·û∑·ûó·û∂·ûÇ·ûó·û∂·ûñ·ûü·üí·ûö·ûü·üã",
            "result_title": "üìä ·ûõ·ûë·üí·ûí·ûï·ûõ·ûÖ·üÜ·ûé·û∂·ûè·üã·ûê·üí·ûì·û∂·ûÄ·üã",
            "confidence": "·ûó·û∂·ûñ·ûá·ûø·ûá·û∂·ûÄ·üã",
            "details_title": "üìà ·ûñ·üê·ûè·üå·ûò·û∂·ûì·ûõ·ûò·üí·û¢·û∑·ûè·ûî·üí·ûö·ûº·ûî·û∂·ûî·üä·û∏·ûõ·û∏·ûí·û∏",
            "recommendation_title": "üí° ·ûÄ·û∂·ûö·ûé·üÇ·ûì·û∂·üÜ",
            "share_title": "üîó ·ûÖ·üÇ·ûÄ·ûö·üÜ·ûõ·üÇ·ûÄ·ûõ·ûë·üí·ûí·ûï·ûõ",
            "zalo_btn": "üì± ·ûï·üí·ûâ·ûæ·ûè·û∂·ûò·ûö·ûô·üà Zalo",
            "email_btn": "üìß ·ûï·üí·ûâ·ûæ·ûè·û∂·ûò·ûö·ûô·üà Email"
        }
    
    # Main content - Th√™m tabs cho Upload v√† Camera
    tab1, tab2 = st.tabs([ui_text['upload_title'], ui_text['camera_title']])
    
    # Tab 1: Upload ·∫£nh
    with tab1:
        col1, col2 = st.columns([1, 1])
        
        with col1:
            st.markdown(f"### {ui_text['upload_title']}")
            st.markdown(f"**{ui_text['upload_desc']}**")
            uploaded_file = st.file_uploader(
                "Ch·ªçn ·∫£nh th·ªãt c·∫ßn ph√¢n lo·∫°i",
                type=['png', 'jpg', 'jpeg'],
                help="H·ªó tr·ª£ ƒë·ªãnh d·∫°ng PNG, JPG, JPEG"
            )
        
            if uploaded_file is not None:
                # Hi·ªÉn th·ªã ·∫£nh ƒë√£ upload
                image = Image.open(uploaded_file)
                st.image(image, caption="·∫¢nh ƒë√£ upload", use_column_width=True)
                
                # N√∫t d·ª± ƒëo√°n v·ªõi style MONFRESH
                if st.button(ui_text['analyze_btn'], type="primary", key="upload_predict", use_container_width=True):
                    analyze_image_monfresh(model, image, col2, class_names, ui_text)
        
        with col2:
            if uploaded_file is None:
                st.header("üìä K·∫øt qu·∫£ ph√¢n lo·∫°i")
                st.info("üëÜ Vui l√≤ng upload ·∫£nh ·ªü c·ªôt b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch")
                
                # Hi·ªÉn th·ªã ·∫£nh m·∫´u ho·∫∑c h∆∞·ªõng d·∫´n
                st.markdown("""
                ### üéØ M·∫πo ƒë·ªÉ c√≥ k·∫øt qu·∫£ t·ªët nh·∫•t:
                - S·ª≠ d·ª•ng ·∫£nh c√≥ ƒë·ªô ph√¢n gi·∫£i cao
                - ƒê·∫£m b·∫£o √°nh s√°ng ƒë·ªß v√† ƒë·ªÅu
                - Th·ªãt n√™n ƒë∆∞·ª£c ch·ª•p r√µ n√©t
                - Tr√°nh b√≥ng ƒë·ªï che khu·∫•t
                """)
    
    # Tab 2: Ch·ª•p ·∫£nh t·ª´ camera
    with tab2:
        col1, col2 = st.columns([1, 1])
        
        with col1:
            st.markdown(f"### {ui_text['camera_title']}")
            
            # Kh·ªüi t·∫°o session state cho camera
            if 'camera_enabled' not in st.session_state:
                st.session_state.camera_enabled = False
            
            # N√∫t ƒë·ªÉ b·∫≠t/t·∫Øt camera
            if not st.session_state.camera_enabled:
                if st.button("üì∑ B·∫≠t Camera", type="primary", key="enable_camera"):
                    st.session_state.camera_enabled = True
                    st.rerun()
                st.info("üëÜ Click n√∫t 'B·∫≠t Camera' ƒë·ªÉ m·ªü camera v√† ch·ª•p ·∫£nh")
            else:
                # Hi·ªÉn th·ªã n√∫t t·∫Øt camera
                col_a, col_b = st.columns([1, 1])
                with col_a:
                    if st.button("üì∑ T·∫Øt Camera", key="disable_camera"):
                        st.session_state.camera_enabled = False
                        st.rerun()
                with col_b:
                    if st.button("üîÑ Ch·ª•p ·∫£nh m·ªõi", key="new_photo"):
                        # Reset camera ƒë·ªÉ ch·ª•p ·∫£nh m·ªõi
                        pass
                
                # Camera input ch·ªâ hi·ªÉn th·ªã khi ƒë∆∞·ª£c b·∫≠t
                camera_photo = st.camera_input(
                    "Ch·ª•p ·∫£nh th·ªãt c·∫ßn ph√¢n lo·∫°i", 
                    help="Click v√†o n√∫t camera ƒë·ªÉ ch·ª•p ·∫£nh",
                    key="camera_input"
                )
                
                if camera_photo is not None:
                    # Hi·ªÉn th·ªã ·∫£nh ƒë√£ ch·ª•p
                    camera_image = Image.open(camera_photo)
                    st.image(camera_image, caption="·∫¢nh ƒë√£ ch·ª•p", use_column_width=True)
                    
                                    # N√∫t d·ª± ƒëo√°n
                if st.button(ui_text['analyze_btn'], type="primary", key="camera_predict"):
                    analyze_image_monfresh(model, camera_image, col2, class_names, ui_text)
        
        with col2:
            if not st.session_state.camera_enabled:
                st.header("üìä K·∫øt qu·∫£ ph√¢n lo·∫°i")
                st.info("üëÜ Vui l√≤ng b·∫≠t camera ·ªü c·ªôt b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu")
                
                # H∆∞·ªõng d·∫´n ch·ª•p ·∫£nh
                st.markdown("""
                ### üì∑ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng camera:
                1. **Click "B·∫≠t Camera"** ƒë·ªÉ k√≠ch ho·∫°t camera
                2. **ƒê·∫∑t th·ªãt** tr√™n n·ªÅn s√°ng, ph·∫≥ng
                3. **Gi·ªØ camera ·ªïn ƒë·ªãnh** khi ch·ª•p
                4. **ƒê·∫£m b·∫£o √°nh s√°ng** ƒë·ªß s√°ng v√† ƒë·ªÅu
                5. **Ch·ª•p t·ª´ g√≥c nh√¨n tr·ª±c di·ªán**
                6. **Tr√°nh ph·∫£n quang** v√† b√≥ng ƒë·ªï che khu·∫•t
                
                üí° **L∆∞u √Ω**: Camera ch·ªâ b·∫≠t khi c·∫ßn ƒë·ªÉ ti·∫øt ki·ªám t√†i nguy√™n
                """)
            elif camera_photo is None:
                st.header("üìä K·∫øt qu·∫£ ph√¢n lo·∫°i")
                st.info("üëÜ Vui l√≤ng ch·ª•p ·∫£nh ·ªü c·ªôt b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch")
                
                st.markdown("""
                ### ‚úÖ Camera ƒë√£ s·∫µn s√†ng!
                - Click v√†o n√∫t camera ƒë·ªÉ ch·ª•p ·∫£nh
                - C√≥ th·ªÉ "T·∫Øt Camera" khi kh√¥ng d√πng ƒë·ªÉ ti·∫øt ki·ªám t√†i nguy√™n
                """)
    
    # Footer MONFRESH
    st.markdown("---")
    st.markdown("""
    <div class="footer">
        <h3>ü•© MONFRESH - Chu·∫©n h√≥a ƒë·ªô t∆∞∆°i ‚Äì N√¢ng t·∫ßm th·ª±c ph·∫©m</h3>
        <p><strong>MONFRESH</strong> l√† m·ªôt n·ªÅn t·∫£ng c√¥ng ngh·ªá ·ª©ng d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o (AI) gi√∫p ki·ªÉm tra ƒë·ªô t∆∞∆°i c·ªßa th·ªãt m·ªôt c√°ch nhanh ch√≥ng, kh√°ch quan v√† d·ªÖ s·ª≠ d·ª•ng ‚Äì ch·ªâ b·∫±ng m·ªôt b·ª©c ·∫£nh ch·ª•p t·ª´ ƒëi·ªán tho·∫°i.</p>
        
        <h4>üîç MONFRESH ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?</h4>
        <ul>
            <li>Ng∆∞·ªùi d√πng ch·ªâ c·∫ßn truy c·∫≠p web/app MONFRESH, ch·ª•p ·∫£nh mi·∫øng th·ªãt b·∫±ng camera ƒëi·ªán tho·∫°i.</li>
            <li>H·ªá th·ªëng AI s·∫Ω ph√¢n t√≠ch ·∫£nh v√† ph√¢n lo·∫°i th·ªãt th√†nh 3 c·∫•p ƒë·ªô: T∆∞∆°i ‚Äì S·∫Øp h∆∞ ‚Äì H∆∞ h·ªèng.</li>
            <li>M·ªói l·∫ßn ki·ªÉm tra ƒë∆∞·ª£c l∆∞u k√®m th·ªùi gian, v·ªã tr√≠, ·∫£nh g·ªëc v√† k·∫øt qu·∫£ ‚Üí t·∫°o th√†nh h·ªì s∆° ƒë·ªô t∆∞∆°i c√≥ th·ªÉ truy xu·∫•t.</li>
        </ul>
        
        <h4>üéØ ƒê·ªëi t∆∞·ª£ng s·ª≠ d·ª•ng</h4>
        <ul>
            <li>Ti·ªÉu th∆∞∆°ng t·∫°i ch·ª£ truy·ªÅn th·ªëng c·∫ßn c√¥ng c·ª• ch·ª©ng minh ch·∫•t l∆∞·ª£ng.</li>
            <li>Ng∆∞·ªùi ti√™u d√πng tr·∫ª ∆∞u ti√™n th·ª±c ph·∫©m an to√†n v√† c√≥ th·ªÉ truy xu·∫•t.</li>
            <li>C∆° quan qu·∫£n l√Ω VSATTP c·∫ßn gi√°m s√°t hi·ªáu qu·∫£ t·∫°i c·∫•p ph∆∞·ªùng/x√£.</li>
            <li>Chu·ªói si√™u th·ªã, nh√† m√°y ch·∫ø bi·∫øn mu·ªën t√≠ch h·ª£p c√¥ng ngh·ªá AI gi√°m s√°t ƒë·∫ßu v√†o.</li>
        </ul>
        
        <h4>‚öôÔ∏è ƒêi·ªÉm n·ªïi b·∫≠t c·ªßa MONFRESH</h4>
        <ul>
            <li>Kh√¥ng ph√° m·∫´u ‚Äì Kh√¥ng c·∫ßn thi·∫øt b·ªã chuy√™n d·ª•ng ‚Äì Kh√¥ng y√™u c·∫ßu k·ªπ thu·∫≠t vi√™n.</li>
            <li>Ch·∫°y tr·ª±c ti·∫øp tr√™n ƒëi·ªán tho·∫°i ho·∫∑c web, d·ªÖ s·ª≠ d·ª•ng, ti·∫øt ki·ªám chi ph√≠.</li>
            <li>D·ªÖ t√≠ch h·ª£p v·ªõi h·ªá th·ªëng b√°n h√†ng, truy xu·∫•t, th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠ v√† qu·∫£n l√Ω nh√† n∆∞·ªõc.</li>
        </ul>
        
        <h4>üë• Nh√≥m ph√°t tri·ªÉn</h4>
        <p>D·ª± √°n ƒë∆∞·ª£c th·ª±c hi·ªán b·ªüi nh√≥m MONFRESH, bao g·ªìm c√°c sinh vi√™n, k·ªπ s∆∞ v√† chuy√™n gia li√™n ng√†nh: AI, c√¥ng ngh·ªá th·ª±c ph·∫©m, kinh doanh v√† qu·∫£n l√Ω d·ªØ li·ªáu. ƒê·∫°i di·ªán nh√≥m d·ª± √°n: ƒê·∫∑ng Ho√†ng Khang.</p>
        
        <h4>üîó Li√™n h·ªá</h4>
        <p>Fanpage: <a href="https://www.facebook.com/profile.php?id=61577355852837" target="_blank">MONFRESH Facebook</a></p>
        <p>ƒê·ªëi t√°c c√¥ng ngh·ªá: Industrial University of Ho Chi Minh City & Ecotech - TechFest Vietnam</p>
    </div>
    """, unsafe_allow_html=True)

if __name__ == "__main__":
    main() 